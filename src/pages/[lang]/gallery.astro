---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer';

import '../../styles/global.css';
import { ChevronRight, Tag } from 'lucide-react';

// Gallery filter //
import GalleryGrid from '../../components/ui/galleryGrid';
import { getMediaByFilter, getMediaCategories } from "../../lib/media";

const url = new URL(Astro.request.url);
const filter = url.searchParams.get('f') ?? undefined;
const media = getMediaByFilter(filter);
const categories = getMediaCategories();
const activeFilter = url.searchParams.get('f') ?? "default";

// i18n Settings  //
import { useLang } from '../../hooks/useLang';
import { useLangPageTexts } from '../../hooks/useLangPageText';
import { getStaticPaths } from '../../i18n/utils/i18n';
import { galleryTexts as enGalleryTexts } from '../../i18n/en/gallery';
import { galleryTexts as esGalleryTexts } from '../../i18n/es/gallery';
import type { LangTypes } from '../../i18n/utils/types';

export { getStaticPaths };

const galleryTextsByLang = {
    en: enGalleryTexts,
    es: esGalleryTexts,
};

const texts = useLangPageTexts<LangTypes>(Astro, galleryTextsByLang);
const lang = useLang(Astro);

export const prerender = false;
---

<Layout lang="{lang}">
  <head>
      <title>{` ${texts.title}${filter ? filter : 'All' } - Imperio Pools`}</title>
  </head>
  <Header lang={lang} />
  <section class="w-full pt-20 pb-0 max-w-7xl mx-auto">
    <h2 class="global-section-text mb-8 text-center">
      {lang === 'en' ? 'Projects of ' : 'Proyectos de '} {filter === 'replastering' ? filter : 'All' }
    </h2>
  </section>

  <section class="w-full h-3/4 pt-0 mb-4 max-w-7xl grid md:grid-cols-[240px_1fr] gap-8 mx-auto">
    <aside>
    <!-- breadcrumb -->
      <div class="breadcrumb">
        <span> Gallery </span>
        <ChevronRight className="mx-2 h-6" />
        <span> {filter} </span>
      </div>
      <!-- ✅ Content Table -->
      <div class="w-full h-full px-4 rounded-2xl dark:bg-light/10 bg-dark/20 space-y-2 hidden md:block">
        <h3 class="global-subheading my-3 pt-2"> Content Table </h3>
        <ul class="space-y-1">
          {categories.map(cat => (
            <li>
              <a 
                href={`/${lang}/gallery?f=${cat}`} 
                class={`flex items-center rounded hover:bg-gray-100 ${
                  cat === activeFilter ? 'font-bold text-blue-600' : 'global-text'
                }`}
              >
                <Tag className="mr-2 h-4"/>{cat.replace("-", " ")}
              </a>
            </li>
          ))}
        </ul>
      </div>
    </aside>

  <!-- ✅ Item content -->
  <div class="relative">
    <!-- Tags -->
    <div class="flex justify-center mb-2 gap-2 md:hidden">
      {categories.map(cat => (
        <a 
          href={ `/${lang}/gallery?f=${cat}` } 
          class={`tag ${
            cat === filter 
            ? 'bg-blue-100 text-blue-600 font-semibold border-blue-400' 
            : 'border-gray-300 hover:bg-light dark:hover:bg-light/10 text-dark dark:text-light'
          }`}
        >
          <Tag className="mr-2 h-4"/>{cat.replace("-", " ")}
        </a>
      ))}
    </div>
    <!-- Content -->
    <div>
      <GalleryGrid images={media} client:load/>
    </div>
  </div>
  </section>

  <Footer client:load />
</Layout>

<style>
  .tag {
    @apply flex px-2 py-1 pr-4 items-center rounded-full border transition-all duration-300 ease-in-out;
  }
</style>