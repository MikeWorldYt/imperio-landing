---
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/layout/Header.astro';
import Footer from '../../../components/layout/Footer';

import '../../../styles/global.css';
import { Box, ChevronRight } from "lucide-react";

// i18n Settings  //
import { getLangFromUrl } from '../../../i18n/utils/i18n';
import { servicesTexts as enServicesTexts } from '../../../i18n/en/services';
import { servicesTexts as esServicesTexts } from '../../../i18n/es/services';
import { Button } from '../../../components/ui/Button';

const url = new URL(Astro.request.url);
const lang = getLangFromUrl(url);

const servicesTextsByLang = {
  en: enServicesTexts,
  es: esServicesTexts,
};
const allServices = servicesTextsByLang[lang].services;

export const getStaticPaths = async () => {
  const langs = ['en', 'es'];
  // Define the services texts for each language
  const servicesTextsByLang: any = {
    en: enServicesTexts,
    es: esServicesTexts,
  };
  //
  return langs.flatMap(lang => {
    const services = servicesTextsByLang[lang].services;
    
    //
    return services.map((service: any) => ({
      params: { lang, id: service.id },
      props: { service },
    }));
  });
};

const { service } = Astro.props;

export const prerender = true;
---

<Layout>
  <head>
    <title>
      { lang === 'en' ? 'Service ' : 'Servicio ' }{service.title} - Imperio Pools
    </title>
  </head>
  <Header client:load lang={lang} />

  <section class="w-full pt-20 pb-0 max-w-7xl mx-auto">
    <h2 class="global-section-text mb-8 text-center" transition:name={service.id}>
      { service.title }
    </h2>
  </section>

  <section class="w-full h-3/4 pt-0 mb-4 max-w-7xl mx-auto grid md:grid-cols-[240px_1fr] gap-8">
    <aside>
    <!-- breadcrumb -->
    <div class="breadcrumb">
      <a href={`/${lang}/services`} class="underline">
        Services
      </a>
      <ChevronRight className="mx-2 h-6" />
      <span>{service.title}</span>
    </div>
    <!-- ✅ Content Table -->
    <div class="w-full h-full px-4 rounded-2xl dark:bg-light/10 bg-dark/20 space-y-2 hidden md:block">
      <h3 class="global-subheading my-3 pt-2"> Content Table </h3>
      <ul class="space-y-1">
        {allServices.map(s => (
          <li>
            <a 
              href={`/${lang}/services/${s.id}`} 
              class={`block rounded hover:bg-gray-100 ${
                s.id === service.id ? 'font-bold text-blue-600' : 'global-text'
              }`}
            >
              <Box className="mx-2 h-4"/>{s.title}
            </a>
          </li>
        ))}
      </ul>
    </div>
    </aside>

    <!-- ✅ Item content -->
    <div class="relative">
      <div class="global-text">
        <p>{service.description}</p>
        <h2 class="global-heading mb-3"> Lorem </h2>
        <p set:html={service.content} />
      </div>
      <div class="absolute bottom-4 w-full">
        <p> {lang==='en' ? '' : ''} </p>
        <div class="flex gap-8">
          <Button
            variant='secondary'
            href={`/${lang}/gallery?f=${service.id}`}
            text={lang === 'en' ? 'Learn More' : 'Más Información'}
          />
          <Button
            variant='primary'
            href={`/${lang}/get-quote/form?s=${service.id}`}
            text={lang === 'en' ? 'Get a Free Stimate Now →' : 'Obtener una Cotización Gratis →'}
          />
        </div>
      </div>
    </div>

  </section>
  <Footer client:load />
</Layout>